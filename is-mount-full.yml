---
- name: Print reports about drive mounts
  hosts: "{{ target }}"
  gather_facts: true
  vars_files:
    - vars/report_vars.yml
  tasks:
    - name: parse through mount variable
      debug: 
        msg: |
            "Drive is mounted at {{ item.mount }} 
            {% if item.block_used/item.block_total * 100 > 80 -%} 
            ----- drive is UNHEALTHY!!: {{ item.block_used/item.block_total * 100 }}% full. 
            {% elif item.block_used/item.block_total * 100 < 80 -%} 
            ----- drive is HEALTHY: {{ item.block_used/item.block_total * 100 }}%
            {%endif %}"
      loop: "{{ ansible_mounts }}"
      loop_control:
        label: "{{  item.mount }}"
      register: disk_var

      copy: 
        content: "{{ item.content }}"
        dest: "{{ item.dest }}"
        owner: "{{ item.owner }}"
        group: "{{ item.group }}"
        mode: "{{ item.mode }}"
        setype: "{{ item.setype }}"
      loop: "{{ copy_results }"
      register: copy_handoff
      notify: display new file

  handlers:
    - name: display contents of new file
      debug:
        msg: |
          "{{ lookup('pipe','cat') + item.dest | quote }}"
      loop: "{{ copy_results }}"
